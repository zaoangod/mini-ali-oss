const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="ARRAYBUFFER not supported by this environment",e="UINT8ARRAY not supported by this environment";function a(t,i,e,a){let n,o,s;const p=i||[0],l=(e=e||0)>>>3,r=-1===a?3:0;for(n=0;n<t.length;n+=1)s=n+l,o=s>>>2,p.length<=o&&p.push(0),p[o]|=t[n]<<8*(r+a*(s%4));return{value:p,binLen:8*t.length+e}}function n(n,o,s){switch(o){case"UTF8":case"UTF16BE":case"UTF16LE":break;default:throw new Error("encoding must be UTF8, UTF16BE, or UTF16LE")}switch(n){case"HEX":return function(t,i,e){return function(t,i,e,a){let n,o,s,p;if(0!=t.length%2)throw new Error("String of HEX type must be in byte increments");const l=i||[0],r=(e=e||0)>>>3,c=-1===a?3:0;for(n=0;n<t.length;n+=2){if(o=parseInt(t.substr(n,2),16),isNaN(o))throw new Error("String of HEX type contains invalid characters");for(p=(n>>>1)+r,s=p>>>2;l.length<=s;)l.push(0);l[s]|=o<<8*(c+a*(p%4))}return{value:l,binLen:4*t.length+e}}(t,i,e,s)};case"TEXT":return function(t,i,e){return function(t,i,e,a,n){let o,s,p,l,r,c,m,u,h=0;const d=e||[0],f=(a=a||0)>>>3;if("UTF8"===i)for(m=-1===n?3:0,p=0;p<t.length;p+=1)for(o=t.charCodeAt(p),s=[],128>o?s.push(o):2048>o?(s.push(192|o>>>6),s.push(128|63&o)):55296>o||57344<=o?s.push(224|o>>>12,128|o>>>6&63,128|63&o):(p+=1,o=65536+((1023&o)<<10|1023&t.charCodeAt(p)),s.push(240|o>>>18,128|o>>>12&63,128|o>>>6&63,128|63&o)),l=0;l<s.length;l+=1){for(c=h+f,r=c>>>2;d.length<=r;)d.push(0);d[r]|=s[l]<<8*(m+n*(c%4)),h+=1}else for(m=-1===n?2:0,u="UTF16LE"===i&&1!==n||"UTF16LE"!==i&&1===n,p=0;p<t.length;p+=1){for(o=t.charCodeAt(p),!0===u&&(l=255&o,o=l<<8|o>>>8),c=h+f,r=c>>>2;d.length<=r;)d.push(0);d[r]|=o<<8*(m+n*(c%4)),h+=2}return{value:d,binLen:8*h+a}}(t,o,i,e,s)};case"B64":return function(i,e,a){return function(i,e,a,n){let o,s,p,l,r,c,m,u=0;const h=e||[0],d=(a=a||0)>>>3,f=-1===n?3:0,x=i.indexOf("=");if(-1===i.search(/^[a-zA-Z0-9=+/]+$/))throw new Error("Invalid character in base-64 string");if(i=i.replace(/=/g,""),-1!==x&&x<i.length)throw new Error("Invalid '=' found in base-64 string");for(s=0;s<i.length;s+=4){for(r=i.substr(s,4),l=0,p=0;p<r.length;p+=1)o=t.indexOf(r.charAt(p)),l|=o<<18-6*p;for(p=0;p<r.length-1;p+=1){for(m=u+d,c=m>>>2;h.length<=c;)h.push(0);h[c]|=(l>>>16-8*p&255)<<8*(f+n*(m%4)),u+=1}}return{value:h,binLen:8*u+a}}(i,e,a,s)};case"BYTES":return function(t,i,e){return function(t,i,e,a){let n,o,s,p;const l=i||[0],r=(e=e||0)>>>3,c=-1===a?3:0;for(o=0;o<t.length;o+=1)n=t.charCodeAt(o),p=o+r,s=p>>>2,l.length<=s&&l.push(0),l[s]|=n<<8*(c+a*(p%4));return{value:l,binLen:8*t.length+e}}(t,i,e,s)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch(t){throw new Error(i)}return function(t,i,e){return function(t,i,e,n){return a(new Uint8Array(t),i,e,n)}(t,i,e,s)};case"UINT8ARRAY":try{new Uint8Array(0)}catch(t){throw new Error(e)}return function(t,i,e){return a(t,i,e,s)};default:throw new Error("format must be HEX, TEXT, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}function o(a,n,o,s){switch(a){case"HEX":return function(t){return function(t,i,e,a){const n="0123456789abcdef";let o,s,p="";const l=i/8,r=-1===e?3:0;for(o=0;o<l;o+=1)s=t[o>>>2]>>>8*(r+e*(o%4)),p+=n.charAt(s>>>4&15)+n.charAt(15&s);return a.outputUpper?p.toUpperCase():p}(t,n,o,s)};case"B64":return function(i){return function(i,e,a,n){let o,s,p,l,r,c="";const m=e/8,u=-1===a?3:0;for(o=0;o<m;o+=3)for(l=o+1<m?i[o+1>>>2]:0,r=o+2<m?i[o+2>>>2]:0,p=(i[o>>>2]>>>8*(u+a*(o%4))&255)<<16|(l>>>8*(u+a*((o+1)%4))&255)<<8|r>>>8*(u+a*((o+2)%4))&255,s=0;s<4;s+=1)c+=8*o+6*s<=e?t.charAt(p>>>6*(3-s)&63):n.b64Pad;return c}(i,n,o,s)};case"BYTES":return function(t){return function(t,i,e){let a,n,o="";const s=i/8,p=-1===e?3:0;for(a=0;a<s;a+=1)n=t[a>>>2]>>>8*(p+e*(a%4))&255,o+=String.fromCharCode(n);return o}(t,n,o)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch(t){throw new Error(i)}return function(t){return function(t,i,e){let a;const n=i/8,o=new ArrayBuffer(n),s=new Uint8Array(o),p=-1===e?3:0;for(a=0;a<n;a+=1)s[a]=t[a>>>2]>>>8*(p+e*(a%4))&255;return o}(t,n,o)};case"UINT8ARRAY":try{new Uint8Array(0)}catch(t){throw new Error(e)}return function(t){return function(t,i,e){let a;const n=i/8,o=-1===e?3:0,s=new Uint8Array(n);for(a=0;a<n;a+=1)s[a]=t[a>>>2]>>>8*(o+e*(a%4))&255;return s}(t,n,o)};default:throw new Error("format must be HEX, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}function s(t){const i={outputUpper:!1,b64Pad:"=",outputLen:-1},e=t||{},a="Output length must be a multiple of 8";if(i.outputUpper=e.outputUpper||!1,e.b64Pad&&(i.b64Pad=e.b64Pad),e.outputLen){if(e.outputLen%8!=0)throw new Error(a);i.outputLen=e.outputLen}else if(e.shakeLen){if(e.shakeLen%8!=0)throw new Error(a);i.outputLen=e.shakeLen}if("boolean"!=typeof i.outputUpper)throw new Error("Invalid outputUpper formatting option");if("string"!=typeof i.b64Pad)throw new Error("Invalid b64Pad formatting option");return i}class p{constructor(t,i,e){const a=e||{};if(this.t=i,this.i=a.encoding||"UTF8",this.numRounds=a.numRounds||1,isNaN(this.numRounds)||this.numRounds!==parseInt(this.numRounds,10)||1>this.numRounds)throw new Error("numRounds must a integer >= 1");this.o=t,this.h=[],this.u=0,this.l=!1,this.A=0,this.p=!1,this.U=[],this.R=[]}update(t){let i,e=0;const a=this.T>>>5,n=this.F(t,this.h,this.u),o=n.binLen,s=n.value,p=o>>>5;for(i=0;i<p;i+=a)e+this.T<=o&&(this.m=this.g(s.slice(i,i+a),this.m),e+=this.T);return this.A+=e,this.h=s.slice(e>>>5),this.u=o%this.T,this.l=!0,this}getHash(t,i){let e,a,n=this.B;const p=s(i);if(this.v){if(-1===p.outputLen)throw new Error("Output length must be specified in options");n=p.outputLen}const l=o(t,n,this.H,p);if(this.p&&this.C)return l(this.C(p));for(a=this.Y(this.h.slice(),this.u,this.A,this.I(this.m),n),e=1;e<this.numRounds;e+=1)this.v&&n%32!=0&&(a[a.length-1]&=16777215>>>24-n%32),a=this.Y(a,n,0,this.L(this.o),n);return l(a)}setHMACKey(t,i,e){if(!this.M)throw new Error("Variant does not support HMAC");if(this.l)throw new Error("Cannot set MAC key after calling update");const a=n(i,(e||{}).encoding||"UTF8",this.H);this.N(a(t))}N(t){const i=this.T>>>3,e=i/4-1;let a;if(1!==this.numRounds)throw new Error("Cannot set numRounds with MAC");if(this.p)throw new Error("MAC key already set");for(i<t.binLen/8&&(t.value=this.Y(t.value,t.binLen,0,this.L(this.o),this.B));t.value.length<=e;)t.value.push(0);for(a=0;a<=e;a+=1)this.U[a]=909522486^t.value[a],this.R[a]=1549556828^t.value[a];this.m=this.g(this.U,this.m),this.A=this.T,this.p=!0}getHMAC(t,i){const e=s(i);return o(t,this.B,this.H,e)(this.S())}S(){let t;if(!this.p)throw new Error("Cannot call getHMAC without first setting MAC key");const i=this.Y(this.h.slice(),this.u,this.A,this.I(this.m),this.B);return t=this.g(this.R,this.L(this.o)),t=this.Y(i,this.B,this.T,t,this.B),t}}function l(t,i){return t<<i|t>>>32-i}function r(t,i,e){return t^i^e}function c(t,i,e){return t&i^t&e^i&e}function m(t,i){const e=(65535&t)+(65535&i);return(65535&(t>>>16)+(i>>>16)+(e>>>16))<<16|65535&e}function u(t,i,e,a,n){const o=(65535&t)+(65535&i)+(65535&e)+(65535&a)+(65535&n);return(65535&(t>>>16)+(i>>>16)+(e>>>16)+(a>>>16)+(n>>>16)+(o>>>16))<<16|65535&o}function h(t){return[1732584193,4023233417,2562383102,271733878,3285377520]}function d(t,i){let e,a,n,o,s,p,h;const d=[];for(e=i[0],a=i[1],n=i[2],o=i[3],s=i[4],h=0;h<80;h+=1)d[h]=h<16?t[h]:l(d[h-3]^d[h-8]^d[h-14]^d[h-16],1),p=h<20?u(l(e,5),(f=a)&n^~f&o,s,1518500249,d[h]):h<40?u(l(e,5),r(a,n,o),s,1859775393,d[h]):h<60?u(l(e,5),c(a,n,o),s,2400959708,d[h]):u(l(e,5),r(a,n,o),s,3395469782,d[h]),s=o,o=n,n=l(a,30),a=e,e=p;var f;return i[0]=m(e,i[0]),i[1]=m(a,i[1]),i[2]=m(n,i[2]),i[3]=m(o,i[3]),i[4]=m(s,i[4]),i}function f(t,i,e,a){let n;const o=15+(i+65>>>9<<4),s=i+e;for(;t.length<=o;)t.push(0);for(t[i>>>5]|=128<<24-i%32,t[o]=4294967295&s,t[o-1]=s/4294967296|0,n=0;n<t.length;n+=16)a=d(t.slice(n,n+16),a);return a}class x extends p{constructor(t,i,e){if("SHA-1"!==t)throw new Error("Chosen SHA variant is not supported");super(t,i,e);const a=e||{};this.M=!0,this.C=this.S,this.H=-1,this.F=n(this.t,this.i,this.H),this.g=d,this.I=function(t){return t.slice()},this.L=h,this.Y=f,this.m=[1732584193,4023233417,2562383102,271733878,3285377520],this.T=512,this.B=160,this.v=!1,a.hmacKey&&this.N(function(t,i,e,a){const o="hmacKey must include a value and format";if(!i)throw new Error(o);if(void 0===i.value||!i.format)throw new Error(o);return n(i.format,i.encoding||"UTF8",e)(i.value)}(0,a.hmacKey,this.H))}}const g={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4","mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["*mp4","mp4v","*mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(g);var v={create:async function(t,i,e,a){const n={"Content-Type":"application/json",...a?.header||{}},o={method:i=(i||"GET").toUpperCase(),headers:n,mode:"cors",cache:"no-cache",redirect:"follow",credentials:"same-origin",referrerPolicy:"no-referrer"};return"POST"!=i&&"PUT"!=i||(o.body=JSON.stringify(e||{})),fetch(new Request(t,o))}};class w{debug;config={key:"",secret:"",bucket:"",region:""};constructor(t,i=!1){this.config.key=t.key||"",this.config.secret=t.secret||"",this.config.bucket=t.bucket||"",this.config.region=t.region||"",this.debug=i}async uploadObject(t,i){t=this.clean(t);const e=await this.requestConfig("PUT",t);let a={header:e.header};return await v.create(`${e.baseURL}/${t}`,"PUT",i,a)}async removeObject(t,i){t=this.clean(t);const e=await this.requestConfig("DELETE",t,i);let a={header:e.header};return await v.create(`${e.baseURL}/${t}`,"DELETE",void 0,a)}async requestConfig(t,i,e={}){let a=(new Date).toUTCString();e.Date=a,e["x-oss-date"]=a,e["Content-MD5"]="",e["Content-Type"]=this.contentType(i),e.Authorization=await this.signature(t,i,e);const n=`http://${this.config.bucket}.${this.config.region}.aliyuncs.com`;return this.debug&&(console.info("Bin -> requestConfig, header:",e),console.info("Bin -> requestConfig, baseURL:",n)),{baseURL:n,header:e}}async signature(t,i,e){const a=[],n=[];Object.keys(e).forEach((t=>{let i=e[t];t.startsWith("x-oss")&&n.push(t+":"+i)})),a.push(t?.toUpperCase()||""),a.push(e["Content-Md5"]||""),a.push(e["Content-Type"]||""),a.push(e.Date||""),a.push(...n.sort()),a.push(`/${this.config.bucket}/${i}`);let o=new x("SHA-1","TEXT",{hmacKey:{value:this.config.secret,format:"TEXT"}}).update(a.join("\n")).getHash("B64").toString();return`OSS ${this.config.key}:${o}`}clean(t){return t.split("/").filter((t=>0!=t.length)).join("/")}contentType(t){let i=t.split(".").splice(-1);if(1!=i.length)return"";let e="";return Object.keys(g).forEach((t=>{let a=g[t];Array.isArray(a)&&a.forEach((a=>{a==i[0]?.toLowerCase()&&(e=t)}))})),this.debug&&console.info("Bin -> contentType, type:",e),e}}const b={multiple:!1,accept:"*"};class j{option;input;emitter;constructor(t=b){var i;this.option=t,this.emitter=null,this.emitter={all:i=i||new Map,on(t,e){const a=i.get(t);a?a.push(e):i.set(t,[e])},off(t,e){const a=i.get(t);a&&(e?a.splice(a.indexOf(e)>>>0,1):i.set(t,[]))},emit(t,e){let a=i.get(t);a&&a.slice().map((t=>{t(e)})),a=i.get("*"),a&&a.slice().map((i=>{i(t,e)}))}},this.input=null,this.input=((t,i)=>{const e=document.createElement("input");return e.type="file",e.style.display="none",e.accept=t.accept||"*",e.multiple=t.multiple||!1,e.addEventListener("change",(async t=>{const a=t.target.files;if(a&&0!=a.length)try{i.emit("success",{file:Array.from(a),state:!0,message:""})}catch(t){i.emit("failure",{file:[],state:!1,message:String(t)})}finally{e.value=""}else i.emit("failure",{file:[],state:!1,message:"The file list length is 0"})})),document.body.appendChild(e),e})(this.option,this.emitter)}choose(){this.input?.click();let t=this.emitter;return this.input&&this.emitter?new Promise(((i,e)=>{t?.on("success",(t=>{console.log("file",t),i(t)})),t?.on("failure",(t=>{console.log("failure",t),e(t)}))})):Promise.reject("input loss | emitter loss")}}class y{bin;debug;constructor(t,i=!1){this.bin=new w(t),this.debug=i}async choose(){let t=new j;return await t.choose()}async upload(t,i){let e=await this.bin.uploadObject(t,i);if(this.debug&&(console.info("Service -> upload, response:",e),console.info("Service -> upload, header:",e.headers)),e.ok&&200==e.status){let i=e.headers;return{complete:!0,status:e.status,data:{url:e.url,tag:i.get("etag")?.replaceAll('"',""),name:t,requestId:i.get("x-oss-request-id")}}}return{complete:!1,status:e.status,data:{url:null,tag:null,name:null,requestId:null}}}async remove(t){let i=await this.bin.removeObject(t);this.debug&&(console.info("Service -> remove, response:",i),console.info("Service -> remove, header:",i.headers));let e=i.headers,a={complete:!1,status:500,data:{url:null,name:t,requestId:null}};return i.ok&&204==i.status&&(a={status:i.status,complete:!0,data:{url:i.url,name:t,requestId:e.get("x-oss-request-id")}}),a}async copy(t,i){console.log(t),console.log(i)}}export{y as default};
